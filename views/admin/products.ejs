<!DOCTYPE html>
<html>
  <head>
    <title>Products â€“ Luxvane Admin</title>
    <link rel="stylesheet" href="/stylesheets/layout.css">
    <link rel="stylesheet" href="/stylesheets/products.css">
    <link rel="stylesheet" href="/stylesheets/header.css">
    <link rel="stylesheet" href="/stylesheets/modal.css">
  </head>
  <body>

    <div class="admin-shell">

      <aside class="admin-sidebar">
        <div class="sidebar-header">
          <a href="/owners/products/create" class="sidebar-create-btn">
            + Create Product
          </a>
        </div>
        
        <nav class="sidebar-nav">
          <!-- Main Navigation -->
          <div class="nav-section">
            <a href="/owners/dashboard" class="nav-item">
              <span class="nav-icon">ðŸ“Š</span>
              <span class="nav-label">Dashboard</span>
            </a>
            
            <a href="/owners/products" class="nav-item">
              <span class="nav-icon">ðŸ“¦</span>
              <span class="nav-label">All Products</span>
            </a>
          </div>
          
          <!-- Category Filters -->
          <div class="nav-section">
            <div class="nav-section-header">
              <span class="nav-section-title">Categories</span>
            </div>
            <div class="nav-section-content">
              <% if (categories && categories.length > 0) { %>
                <% categories.forEach(function(category) { %>
                  <a href="/owners/products?category=<%= category._id %>" 
                     class="nav-item nav-item-sub <%= selectedCategory === category._id.toString() ? 'active' : '' %>">
                    <span class="nav-label"><%= category.name %></span>
                  </a>
                <% }); %>
              <% } else { %>
                <div class="nav-empty">No categories</div>
              <% } %>
            </div>
          </div>
        </nav>
      </aside>

      <!-- <aside class="products-sidebar">
        <a href="/owners/products/create" class="btn btn-primary">
          + Create product
        </a>

        <a href="/owners/products" class="<%= !selectedCategory ? 'active' : '' %>"> All products </a>
        
        <h4>Filter by Categories</h4>
        <% categories.forEach(function(category) { %>
          <h4 class="<%= selectedCategory === category._id.toString() ? 'active' : '' %>">
            <a href="/owners/products?category=<%= category._id %>">
              <%= category.name %>
            </a>
          </h4>
        <% }); %>
      </aside> -->

      <!-- MAIN AREA -->
      <div class="admin-main">

        <!-- HEADER -->
        <%- include('../partials/header.ejs') %>

        <!-- FLASH MESSAGES -->
        <% if (success && success.length > 0) { %>
          <div class="flash flash-success"><%= success %></div>
        <% } %>

        <% if (error && error.length > 0) { %>
          <div class="flash flash-error"><%= error %></div>
        <% } %>

        <!-- PAGE CONTENT -->
        <main class="page-container product-page">

          <div class="sort-search-wrapper">
            <div class="search-container">
              <form method="GET" action="/owners/products" class="search-form">
                <input type="text" name="search" class="search-input" placeholder="Search products by name or description"
                value="<%= searchQuery || '' %>" autocomplete="off"/>
                <% if(selectedCategory) { %>
                  <input type="hidden" name="category" value="<%= selectedCategory %>"/>
                <% } %>
                <button type="submit" class="search-btn">Search</button>
              <% if(searchQuery) { %>
                <a href="/owners/products<%= selectedCategory ? '?category=' + selectedCategory : '' %><%= selectedCategory && selectedSort ? '&sort=' + selectedSort : (selectedSort ? '?sort=' + selectedSort : '') %>" class="search-clear">Clear</a>
              <% } %>
              </form>
            </div>

            <div class="sort-container">
              <form method="GET" action="/owners/products" class="sort-form">
                <% if(selectedCategory) { %>
                  <input type="hidden" name="category" value="<%= selectedCategory %>"/>
                <% } %>

                <% if(searchQuery) { %>
                  <input type="hidden" name="search" value="<%= searchQuery %>">
                <% } %>

                <select name="sort" id="sort" class="sort-select" onchange="this.form.submit()" aria-label="Sort products by">
                  <option value="" <%= !selectedSort ? 'selected' : '' %>>Sort by:</option>
                  <option value="name-asc" <%= selectedSort === 'name-asc' ? 'selected' : '' %>>Name (A-Z)</option>
                  <option value="name-desc" <%= selectedSort === 'name-desc' ? 'selected' : '' %>>Name (Z-A)</option>
                  <option value="price-asc" <%= selectedSort === 'price-asc' ? 'selected' : '' %>>Price (Low to High)</option>
                  <option value="price-desc" <%= selectedSort === 'price-desc' ? 'selected' : '' %>>Price (High to Low)</option>
                  <option value="date-asc" <%= selectedSort === 'date-asc' ? 'selected' : '' %>>Date (Oldest First)</option>
                  <option value="date-desc" <%= selectedSort === 'date-desc' ? 'selected' : '' %>>Date (Newest First)</option>
                </select>
              </form>
            </div>
          </div>

          <% if (searchQuery) { %>
            <div class="search-results-info">
              <p> Search results for "<strong><%= searchQuery %></strong>" (<%= products.length %> found) </p> 
            </div>
          <% } %>
          
          <div class="products-grid">
            <% products.forEach(p => { %>
              <div class="product-card">
                <img src="<%= p.image.replace('/upload/', '/upload/w_400,h_400,c_fill,q_auto/') %>" 
                     class="product-img" 
                     loading="lazy"
                     decoding="async"
                     alt="<%= p.name %>" />
                
                <div class="product-card-content">
                  <h2 class="product-name"><%= p.name %></h2>

                  <div class="product-price">
                    <% if (p.discount && p.discount > 0) { %>
                      <span class="product-original-price">$<%= p.price %></span>
                      <span>$<%= (p.price * (1 - p.discount / 100)).toFixed(2) %></span>
                    <% } else { %>
                      <span>$<%= p.price %></span>
                    <% } %>
                  </div>

                  <% if (p.discount && p.discount > 0) { %>
                    <span class="product-discount">
                      <%= p.discount %>% OFF
                    </span>
                  <% } %>

                  <% if (p.description) { %>
                    <p class="product-desc"><%= p.description %></p>
                  <% } %>

                  <div class="product-actions">
                    <a
                      href="/owners/products/<%= p._id %>/edit"
                      class="btn btn-outline"
                    >
                      Edit
                    </a>

                    <form
                      action="/owners/products/<%= p._id %>/delete"
                      method="POST"
                      class="delete-form"
                      data-item-name="<%= p.name %>"
                      data-entity-type="Product"
                    >
                      <button type="button" class="btn btn-danger delete-btn">
                        Delete
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            <% }) %>
          </div>

        </main>
      </div>
    </div>

    <%- include('../partials/delete-modal.ejs') %>

    <script src="/javascripts/delete-modal.js"></script>

  </body>
</html>
