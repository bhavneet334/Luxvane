<!DOCTYPE html>
<html>
  <head>
    <title>Create Product – Luxvane Admin</title>
    <link rel="stylesheet" href="/stylesheets/layout.css" />
    <link rel="stylesheet" href="/stylesheets/product-form.css" />
    <link rel="stylesheet" href="/stylesheets/header.css" />
  </head>

  <body>
    <%- include("../partials/header.ejs") %> 

    <div class="page-container product-container">
      <main class="product-form-page">

        <% if (success && success.length > 0) { %>
          <div class="flash flash-success"><%= success %></div>
        <% } %>

        <% if (error && error.length > 0) { %>
          <div class="flash flash-error"><%= error %></div>
        <% } %>

        <div class="product-form-header">
          <h1 class="page-title">Create Product</h1>

          <a href="/owners/products" class="btn btn-outline">
            Back to Products
          </a>
        </div>

        <form action="/owners/products/create" method="POST" class="product-form" enctype="multipart/form-data">

          <div class="form-row">
            <label for="name">Name</label>
            <input id="name" name="name" type="text" placeholder="Product name" maxlength="200" 
                   value="<%= typeof formData !== 'undefined' && formData ? formData.name : '' %>" required/>
          </div>

          <div class="form-row">
            <label for="price">Price</label>
            <input id="price" name="price" type="number" step="0.01" placeholder="e.g. 49.99" 
                   value="<%= typeof formData !== 'undefined' && formData ? formData.price : '' %>" required />
          </div>

          <div class="form-row">
            <label for="image">Image</label>
            <input id="image" name="uploaded_file" type="file" accept="image/*" />
          </div>

          <div class="form-row">
            <label for="category">Category</label>
              <select name="category" id="category" required>
              <option hidden value="">Select one</option>

              <% categories.forEach(c => { %>
                <option value="<%= c._id %>" 
                        <%= typeof formData !== 'undefined' && formData && formData.category === c._id.toString() ? 'selected' : '' %>>
                  <%= c.name %>
                </option>
              <% }) %>
            </select>
          </div>

          <div class="form-row">
            <label for="description">
              Description
              <button type="submit" formaction="/owners/products/generate-description" formmethod="POST" class="btn-ai-generate">
                ✨ Generate with AI
              </button>
            </label>
            <textarea id="description" name="description" rows="3" placeholder="Description" maxlength="2000"><%= typeof generatedDescription !== 'undefined' ? generatedDescription : (typeof formData !== 'undefined' && formData && formData.description ? formData.description : '') %></textarea>
          </div>

          <div class="form-row">
            <label for="discount">Discount (%)</label>
            <input id="discount" name="discount" type="number" min="0" max="100" placeholder="Optional" 
                   value="<%= typeof formData !== 'undefined' && formData ? formData.discount : '' %>" />
          </div>

          <div class="form-actions">
            <!-- Primary button: main action -->
            <button type="submit" class="btn btn-primary">
              Create Product
            </button>

            <a href="/owners/products" class="btn btn-outline">
              Cancel
            </a>
          </div>

        </form>
      </main>
    </div>
  </body>
</html>
